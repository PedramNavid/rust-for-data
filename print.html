<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Rust For Data</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Introduction</li><li class="chapter-item expanded "><a href="chapter_1.html"><strong aria-hidden="true">1.</strong> An Overview of this book</a></li><li class="chapter-item expanded "><a href="chapter_2.html"><strong aria-hidden="true">2.</strong> Quickstart</a></li><li class="chapter-item expanded affix "><li class="part-title">Part I: The Basics</li><li class="chapter-item expanded "><a href="chapter_3.html"><strong aria-hidden="true">3.</strong> Fetching from an API</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust For Data</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="chapter-1---introduction"><a class="header" href="#chapter-1---introduction">Chapter 1 - Introduction</a></h1>
<h2 id="what-is-this-book-about"><a class="header" href="#what-is-this-book-about">What is this book about?</a></h2>
<p>This series of posts is about using Rust for data engineering tasks for people
who are already familiar with Python and are curious about Rust. It will not
cover every aspect of Rust, or of Python. Instead, it aims to give practical
examples of how common engineering tasks done in Python might be done in Rust,
along with representative benchmarks.</p>
<p>We will cover a variety of topics, including:</p>
<ul>
<li>Getting data from an API</li>
<li>Scraping a website</li>
<li>Parsing data and using structs</li>
<li>Data Transformation</li>
<li>Writing Data</li>
<li>Other topics as I feel like it</li>
</ul>
<p>This book is not an introduction to either Rust or Python. There are many
great resources to both out there. If you are not familiar with Python,
the official <a href="https://docs.python.org/3/tutorial/">Python Tutorial</a> is a great
starting point.</p>
<p>As for Rust, the <a href="https://doc.rust-lang.org/book/">Rust Book</a> is a great
introduction to the language and a must read. I can also recommend
<a href="https://www.manning.com/books/rust-in-action">Rust in Action</a> as well.</p>
<p>In particular, I think it's important to understand some of the core principals
behind static and dynamic typing, as well as memory safety and ownership. The</p>
<h2 id="should-i-use-rust-for-data-engineering"><a class="header" href="#should-i-use-rust-for-data-engineering">Should I use Rust for Data Engineering?</a></h2>
<p>Probably not. Rust is a great language, it is fun, it is pleasant to use, and
it is fast. But choosing a language for a project is more than choosing a
language that is fun. There are <a href="https://mdwdotla.medium.com/using-rust-at-a-startup-a-cautionary-tale-42ab823d9454">cautionary tales</a>
about using Rust at a startup, and I think they are worth reading.</p>
<p>There are many reasons why you might not want to use Rust for data engineering.
The first is that Rust is not as mature as Python. There are many libraries
that are missing. For example, as of this writing, there are no Snowflake
libraries for querying data in that warehouse. Most people do not know Rust,
and it is harder to hire and harder to train people.</p>
<p>There may be good reasons to use Rust for data engineering however. When it
comes to cost and performance, Rust is clearly faster than Python for many
types of tasks. Memory usage is also much lower, which can be important when
you are constrained by small IoT devices, for example.</p>
<p>I can't tell you when to use Rust and when to use Python, but I do believe that
by understanding both languages, their merits and pitfalls, you will be
better positioned to make that decision for yourself.</p>
<h2 id="why-should-i-learn-rust"><a class="header" href="#why-should-i-learn-rust">Why Should I Learn Rust?</a></h2>
<p>Because it is fun to learn new things. I can't promise you that anything
you learn here will ever have a material impact on your life or career. But
if you enjoy learning and tinkering, then you might want to tinker with this.
If you are like me, and you like learning for learning's sake, then you will
enjoy this experience too. I learned vim and lua not because it was useful,
but because I was curious about it. I did end up benfiting from it, but I never
approached it from a purely utilitarian perspective. There are better ways to
spend your time if your goal is purely career advancement.</p>
<p>But, if you are curious about Rust, and if you like to have fun, then I think
you will be pleasantly surprised by what Rust has to offer.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="quickstart"><a class="header" href="#quickstart">Quickstart</a></h1>
<h2 id="installing-rust-and-python"><a class="header" href="#installing-rust-and-python">Installing Rust and Python</a></h2>
<p>You will need Rust and Python installed to follow along the examples here.
There are many ways to setup an environment, especially in Python, I've listed
the one I like here.</p>
<p>For Rust, you can install rust by going to <a href="https://rustup.rs/">rustup.rs</a>.</p>
<p>For Python, I recommend using <a href="https://github.com/pyenv/pyenv">pyenv</a> along with <a href="https://github.com/pyenv/pyenv-virtualenv">pyenv-virtualenv</a>.
With both installed, here is my typicaly workflow:</p>
<pre><code class="language-bash"># Create a folder
mkdir -p ~/projects/somepyproj
cd ~/projects/somepyproj

# Install a recent version of Python
pyenv install 3.10

# Create a virtualenv for the project named proj310
pyenv virtualenv 3.10 proj310
pyenv local proj310

# Confirm pyenv is working
pyenv version
&gt; proj310 (set by /Users/username/projects/somepyproj/.python-version)```
</code></pre>
<h2 id="installing-the-code"><a class="header" href="#installing-the-code">Installing the Code</a></h2>
<p>The code for this book can be found here: <code>https://github.com/PedramNavid/rust-for-data</code></p>
<pre><code class="language-bash">git clone git@github.com:PedramNavid/rust-for-data.git
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fetching-from-an-api"><a class="header" href="#fetching-from-an-api">Fetching from an API</a></h1>
<p>One of the simplest examples to start with is fetching data from an API endpoint.
This is often the beginning of many data pipeline journeys.</p>
<p>In our first case, we will use the <a href="https://openweathermap.org/api">OpenWeatherMap API</a> to fetch the current weather in
a configurable location by providing latitude and longitude.</p>
<p>You will need to sign up for a free account to get an API key, once you've
signed up, <a href="https://home.openweathermap.org/api_keys">create an API key</a>.</p>
<h2 id="starting-a-project"><a class="header" href="#starting-a-project">Starting a Project</a></h2>
<p>One of the first differences between Rust and Python you will experience is
through initializing a project.</p>
<h3 id="rust"><a class="header" href="#rust">Rust</a></h3>
<p>In Rust, this is as simple as running</p>
<pre><code class="language-bash">cargo init wxrs
</code></pre>
<p>This will create a new directory called <code>wxrs</code> with a Hello World example.</p>
<h3 id="python"><a class="header" href="#python">Python</a></h3>
<p>In Python, we create the directory manually, create a virtual environment,
hand-write a <a href="https://setuptools.pypa.io/en/latest/userguide/quickstart.html">pyproject.toml</a>
file, name our dependencies, and then install the Python
package locally.</p>
<pre><code class="language-bash"># Python venv stuff
pyenv virtualenv wxpy
pyenv shell wxpy
pip install --upgrade pip build

# Create the project directory and pyproject.toml
mkdir -p wxpy/wxpy
cd wxpy
vim pyproject.toml
</code></pre>
<pre><code class="language-toml"># pyproject.toml
[project]
name = &quot;wxpy&quot;
version = &quot;0.0.1&quot;
dependencies = [
    &quot;requests&quot;,
    'importlib-metadata; python_version&lt;&quot;3.8&quot;',
]
</code></pre>
<pre><code class="language-bash">
pip install -e .
</code></pre>
<p>Now, admittedly we can skip all of the above steps, create a random file
anywhere we want and run it with <code>python myfile.py</code>, but the goal here is to
build a more stable distribution that can be packaged, shared, and tested.</p>
<h2 id="fetching-the-weather"><a class="header" href="#fetching-the-weather">Fetching the Weather</a></h2>
<p>Now that we have a project, let's fetch the weather. To fetch from an API,
we will use the <code>requests</code> package in Python and the <code>reqwest</code> package in Rust.</p>
<p>We will read the API key from the environment variable, and get the latitude
and longitude from the command line arguments.</p>
<h3 id="python-1"><a class="header" href="#python-1">Python</a></h3>
<pre><code class="language-python"># wxpy/wxpy/main.py
import os
import sys
import requests

API_KEY = os.getenv(&quot;OWM_APPID&quot;)


def get_air_pollution(lat, lon):
    url = f&quot;http://api.openweathermap.org/data/2.5/air_pollution?lat={lat}&amp;lon={lon}&amp;appid={API_KEY}&quot;
    body = requests.get(url).text
    return body


if __name__ == &quot;__main__&quot;:
    usage = f&quot;Usage: python {__file__} &lt;lat&gt; &lt;lon&gt;&quot;

    if len(sys.argv) != 3:
        print(usage)
        sys.exit(1)

    lat = sys.argv[1]
    lon = sys.argv[2]
    body = get_air_pollution(lat, lon)
    print(body)
</code></pre>
<h3 id="rust-1"><a class="header" href="#rust-1">Rust</a></h3>
<pre><pre class="playground"><code class="language-rust editable">// wxrs/src/main.rs
fn get_air_pollution(lat: f32, lon: f32) -&gt; String {
    let api_key = std::env::var(&quot;OWM_APPID&quot;).expect(
        &quot;Environment Variable OWM_APPID not set. Please set it to your
    OpenWeatherMap API key. https://home.openweathermap.org/api_keys&quot;,
    );

    let url = format!(
        &quot;http://api.openweathermap.org/data/2.5/air_pollution?lat={}&amp;lon={}&amp;appid={}&quot;,
        lat, lon, api_key
    );
    reqwest::blocking::get(url)
        .expect(&quot;request failed&quot;)
        .text()
        .expect(&quot;body failed&quot;)
}

fn main() {
    let usage = format!(&quot;Usage: {} [lat] [lon]&quot;, std::env::args().next().unwrap());

    let lat = std::env::args()
        .nth(1)
        .expect(&amp;usage)
        .parse::&lt;f32&gt;()
        .expect(&amp;usage);

    let lon = std::env::args()
        .nth(2)
        .expect(&amp;usage)
        .parse::&lt;f32&gt;()
        .expect(&amp;usage);

    let body = get_air_pollution(lat, lon);
    println!(&quot;{}&quot;, body);
}</code></pre></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="editor.js"></script>
        <script src="mode-rust.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
